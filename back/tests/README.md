# Unit Tests для Backend

Этот каталог содержит unit тесты для бэкенда приложения YugStroyInvest.

## Структура тестов

- `conftest.py` - Конфигурация pytest с фикстурами
- `test_auth.py` - Тесты аутентификации и авторизации
- `test_models.py` - Тесты моделей данных
- `test_company_crud.py` - Тесты CRUD операций с компаниями
- `test_project_crud.py` - Тесты CRUD операций с проектами
- `test_defect_crud.py` - Тесты CRUD операций с дефектами
- `test_decorators.py` - Тесты декораторов
- `test_integration.py` - Интеграционные тесты
- `test_validation.py` - Тесты валидации данных

## Запуск тестов

```bash
# Запуск всех тестов
pytest back/tests/

# Запуск конкретного файла тестов
pytest back/tests/test_auth.py

# Запуск с подробным выводом
pytest back/tests/ -v

# Запуск с покрытием кода
pytest back/tests/ --cov=back --cov-report=html
```

## Фикстуры

Основные фикстуры определены в `conftest.py`:

- `db_session` - Сессия базы данных для тестов
- `client` - TestClient для FastAPI
- `test_company` - Тестовая компания
- `test_admin_user` - Тестовый администратор
- `test_manager_user` - Тестовый менеджер
- `test_engineer_user` - Тестовый инженер
- `test_client_user` - Тестовый клиент
- `test_project` - Тестовый проект
- `test_defect` - Тестовый дефект

## Покрытие тестами

Тесты покрывают:

1. **Аутентификация** (8 тестов)
   - Регистрация пользователей
   - Вход в систему
   - Получение токенов
   - Проверка прав доступа

2. **Модели данных** (8 тестов)
   - Создание и валидация моделей
   - Связи между моделями
   - Enum значения

3. **CRUD операции** (25 тестов)
   - Создание, чтение, обновление, удаление
   - Проверка прав доступа
   - Обработка ошибок

4. **Декораторы** (8 тестов)
   - Проверка ролей пользователей
   - Обработка исключений

5. **Интеграционные тесты** (7 тестов)
   - Полные рабочие процессы
   - Межролевые взаимодействия
   - Согласованность данных

6. **Валидация данных** (10 тестов)
   - Проверка входных данных
   - Обработка невалидных значений
   - Проверка типов данных

**Всего: 66 тестов**

## Требования

- pytest
- fastapi[all]
- sqlalchemy
- pytest-asyncio
- pytest-cov (для покрытия кода)

## Настройка

1. Установите зависимости:
```bash
pip install pytest fastapi[all] sqlalchemy pytest-asyncio pytest-cov
```

2. Убедитесь, что тестовая база данных настроена в `conftest.py`

3. Запустите тесты:
```bash
pytest back/tests/
```
